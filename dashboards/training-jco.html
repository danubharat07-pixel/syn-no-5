<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Trg JCO / Admin Summary</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        background: linear-gradient(135deg, #a8e063, #f6d365);
      }

      /* Page Header */
      .page-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 15px 40px;
        background: linear-gradient(45deg, #a8e063, #f6d365);
        border-bottom: 3px solid #444;
        position: sticky;
        top: 0;
        z-index: 2000;
      }
      .page-header h1 {
        flex: 1;
        text-align: center;
        font-size: 28px;
        font-weight: bold;
        color: #222;
        text-transform: uppercase;
        letter-spacing: 2px;
      }
      .page-title {
        font-size: 28px;
        font-weight: bold;
        color: #222;
        text-transform: uppercase;
        letter-spacing: 2px;
        font-family: "Times New Roman", Times, serif;
      }
      .page-header .logo {
        width: 100px;
        height: 100px;
        object-fit: contain;
      }

      /* Filter Bar */
      .filter-bar {
        position: sticky;
        top: 80px; /* below header */
        z-index: 1000;
        display: flex;
        justify-content: flex-start;
        align-items: center;
        gap: 15px;
        padding: 12px 20px;
        background: linear-gradient(45deg, #a8e063, #f6d365);
        border-bottom: 2px solid #ccc;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }
      .filter-bar label {
        font-weight: bold;
      }
      .filter-bar select,
      .filter-bar input,
      .filter-bar button.bb {
        padding: 6px 10px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 14px;
      }
      .filter-bar button.bb {
        background: linear-gradient(45deg, #ff6b6b, #f06595);
        color: white;
        cursor: pointer;
        transition: 0.3s;
      }
      .filter-bar button:hover {
        background: linear-gradient(45deg, #fa5252, #d6336c);
      }

      /* Table Styling */
      .summary-section {
        margin: 25px;
        padding: 20px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
      }
      .summary-section h2 {
        text-align: center;
        margin-bottom: 15px;
        color: #333;
        font-size: 22px;
      }
      .summary-table {
        width: 100%;
        border-collapse: collapse;
      }
      .summary-table th,
      .summary-table td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: center;
        font-size: 14px;
      }
      .summary-table th {
        background: #f4f4f4;
        font-weight: bold;
        position: sticky;
        top: 120px; /* keeps table headers visible under filter bar */
        z-index: 500;
      }
      .summary-table tr:nth-child(even) {
        background: #f9f9f9;
      }
      .material-card {
        border: 1px solid #ccc;
        padding: 10px;
        margin: 10px;
        border-radius: 10px;
      }
    </style>
    <style>
      /* Attendance Table Styles */
      .student-attendance-info {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .student-details {
        font-weight: bold;
        color: #333;
      }

      .attendance-status {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
      }

      .status-badge {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
      }

      .status-present {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .status-absent {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .status-late {
        background-color: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }

      .status-excused {
        background-color: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }

      .status-not-marked {
        background-color: #e2e3e5;
        color: #383d41;
        border: 1px solid #d6d8db;
      }

      .mark-attendance-btn {
        padding: 4px 8px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
      }

      .mark-attendance-btn:hover {
        background-color: #0056b3;
      }

      .reason,
      .remarks {
        font-size: 11px;
        color: #666;
        font-style: italic;
      }

      .student-row.no-attendance {
        background-color: #f8f9fa;
      }

      .student-row:nth-child(even) {
        background-color: #f2f2f2;
      }

      .student-row:hover {
        background-color: #e8f4fd;
      }

      #attendanceTable table {
        width: 100%;
        border-collapse: collapse;
      }

      #attendanceTable th,
      #attendanceTable td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
        vertical-align: top;
      }

      #attendanceTable th {
        background-color: #f8f9fa;
        font-weight: bold;
        position: sticky;
        top: 0;
      }
      .not-centered td {
        text-align: left;
      }
      .btn-primary {
        background-color: #17a2b8;
        color: white;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-left: 10px;
      }
    </style>
  </head>
  <body>
    <!-- Page Header -->
    <header class="page-header">
      <img src="/LOGO 1 LEFT.png" alt="Left Logo" class="logo" />
      <h1 class="page-title"><u>Trg JCO</u></h1>
      <img src="/syn 5 logo.jpeg" alt="Right Logo" class="logo" />
    </header>

    <!-- Filter Bar -->
    <div class="filter-bar">
      <label>Filter by Result:</label>
      <select id="resultFilter" onchange="applyFilters()">
        <option value="All">All</option>
        <option value="Passed">Passed</option>
        <option value="Failed">Failed</option>
        <option value="Qualified">Qualified</option>
        <option value="Unqualified">Unqualified</option>
        <option value="Selected">Selected</option>
        <option value="Not Selected">Not Selected</option>
        <option value="MM">MM</option>
        <option value="FC">FC</option>
        <option value="SS">SS</option>
      </select>

      <label>Search by Army No:</label>
      <input
        list="armyNoList"
        id="armySearch"
        placeholder="Enter Army No..."
        onkeyup="applyFilters()"
      />
      <datalist id="armyNoList"></datalist>

      <button class="btn-primary bb" onclick="clearFilters()">
        Clear Filters
      </button>
      <button
        style="margin-left: auto"
        class="btn-primary"
        id="btn-logout"
        onclick="logout()"
      >
        Sign Out
      </button>
    </div>

    <!-- Course Summary -->
    <div class="summary-section">
      <h2><b>Course Summary</b></h2>
      <form onsubmit="assignCourseToUser(event)">
        <label>Course</label>
        <select id="courseSelect">
          <option value="">Select Course</option>
        </select>
        &nbsp;
        <label>Students</label>
        <select id="studentSelect">
          <option value="">Select Student</option>
        </select>
        <button class="btn-primary" type="submit">Assign Course</button>
      </form>
      <br />
      <table class="summary-table">
        <thead>
          <tr>
            <th>S No</th>
            <th>Army No</th>
            <th>Rank</th>
            <th>Name</th>
            <th>Course</th>
            <th>Event</th>
            <th>Results</th>
            <th>Remarks</th>
          </tr>
        </thead>
        <tbody id="bpetSummary"></tbody>
      </table>
    </div>

    <div class="summary-section">
      <h2><b>Attendance</b></h2>
      <div style="margin-bottom: 15px">
        <button onclick="getAttendance()" class="btn-primary">
          Refresh Attendance
        </button>
      </div>
      <div id="attendanceTable">
        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Course</th>
              <th>Students</th>
            </tr>
          </thead>
          <tbody id="attendanceTableBody"></tbody>
        </table>
      </div>
    </div>

    <div class="summary-section">
      <h2><b>Sticky Notes</b></h2>
      <div id="sticky-notes-container attendanceTable">
        <table class="summary-table">
          <thead>
            <tr>
              <th>S. No.</th>
              <th>Note</th>
              <th>Created By</th>
              <th>Created At</th>
            </tr>
          </thead>
          <tbody id="sticky-notes-table-body"></tbody>
        </table>
      </div>
    </div>

    <div style="display: flex; flex-direction: row; gap: 20px">
      <div style="flex: 1" class="summary-section add-student">
        <h2><b>Add Student</b></h2>
        <form onsubmit="addStudent(event)">
          <table class="summary-table not-centered">
            <tr>
              <td>Army No</td>
              <td>
                <input
                  placeholder="Army No"
                  type="text"
                  name="army_no"
                  id="armyNo"
                />
              </td>
            </tr>
            <tr>
              <td>Rank</td>
              <td>
                <select name="rank" id="rank">
                  <option value="SEP">SEP</option>
                  <option value="SEP">LNk</option>
                  <option value="NK">NK</option>
                  <option value="HAV">HAV</option>
                </select>
              </td>
            </tr>
            <tr>
              <td>Name</td>
              <td>
                <input placeholder="Name" type="text" name="name" id="name" />
              </td>
            </tr>

            <tr>
              <td colspan="2" style="text-align: end">
                <button class="btn-primary" type="submit">Add Student</button>
              </td>
            </tr>
          </table>
        </form>
      </div>

      <div style="flex: 1" class="summary-section">
        <h2><b>Upload Material / Report</b></h2>
        <form
          class="summary-table not-centered"
          onsubmit="uploadReport(event)"
          enctype="multipart/form-data"
        >
          <table class="summary-table">
            <tr>
              <td><label for="title">Title</label></td>
              <td>
                <input
                  placeholder="Title"
                  type="text"
                  name="title"
                  id="title"
                />
              </td>
            </tr>
            <tr>
              <td><label for="description">Description</label></td>
              <td>
                <input
                  placeholder="Description"
                  type="text"
                  name="description"
                  id="description"
                />
              </td>
            </tr>
            <tr>
              <td><label for="course">Course</label></td>
              <td>
                <select name="course" id="courseSelect-upload">
                  <option value="">Select Course</option>
                </select>
              </td>
            </tr>
            <tr>
              <td><label for="forRole">For Role</label></td>
              <td>
                <select name="forRole" id="forRole">
                  <option value="CO">CO</option>
                  <option value="TrgOffr" selected>TrgOffr</option>
                  <option value="Student">Student</option>
                </select>
              </td>
            </tr>
            <tr>
              <td><label for="type">Type</label></td>
              <td>
                <select name="type" id="type">
                  <option value="report">Report</option>
                  <option value="study">Study</option>
                  <option value="planning">Planning</option>
                </select>
              </td>
            </tr>
            <tr>
              <td><label for="report">File</label></td>
              <td>
                <input type="file" accept=".pdf" name="file" id="file" />
              </td>
            </tr>
            <tr>
              <td colspan="2" style="text-align: end">
                <button class="btn-primary" type="submit">Upload</button>
              </td>
            </tr>
          </table>
        </form>
      </div>
    </div>

    <div class="summary-section">
      <h2><b>Past Courses Tracker</b></h2>
      <form
        class="summary-table not-centered"
        onsubmit="addPastTracker(event)"
        enctype="multipart/form-data"
      >
        <table class="summary-table">
          <tr>
            <td><label for="army_no">Trainee</label></td>
            <td>
              <select name="user" id="user-select-past-tracker" required>
                <option value="">Select Trainee</option>
              </select>
            </td>
          </tr>
          <tr>
            <td><label for="course">Course</label></td>
            <td>
              <select name="course" id="course-select-past-tracker" required></select>
            </td>
          </tr>
          <tr>
            <td><label for="grade">Grade</label></td>
            <td>
              <select name="grade" id="grade">
                <option value="">Select Grade</option>
                <option value="AXI">AX'I'</option>
                <option value="AX">AX</option>
                <option value="A">A</option>
                <option value="BXI">BX'I'</option>
                <option value="BY">BY</option>
                <option value="C">C</option>
              </select>
            </td>
          </tr>
          <tr>
            <td><label for="courseDuration">Course Duration</label></td>
            <td>
              <input
                placeholder="Course Duration"
                type="number"
                name="courseDuration"
                id="courseDuration"
                min="4"
                max="18"
              />
            </td>
          </tr>
          <tr>
            <td><label for="ere">ERE</label></td>
            <td>
              <input placeholder="ERE" type="text" name="ere" id="ere" />
            </td>
          </tr>
          <tr>
            <td><label for="remarks">Remarks</label></td>
            <td>
              <input
                placeholder="Remarks"
                type="text"
                name="remarks"
                id="remarks"
              />
            </td>
          </tr>
          <tr>
            <td colspan="2" style="text-align: end">
              <button class="btn-primary" type="submit">Add</button>
            </td>
          </tr>
        </table>
      </form>
    </div>

    <div class="summary-section">
      <h2><b>Materials</b></h2>
      <div id="materialSelect"></div>
    </div>

    <!-- Filtering Script -->
    <script>
      function applyFilters() {
        let filterValue = document
          .getElementById("resultFilter")
          .value.toLowerCase();
        let searchValue = document
          .getElementById("armySearch")
          .value.toLowerCase();

        let tables = document.querySelectorAll(".summary-table");
        tables.forEach((table) => {
          let rows = table.querySelectorAll("tbody tr");
          rows.forEach((row) => {
            let cells = row.querySelectorAll("td");
            let armyNo = cells[1]?.innerText.toLowerCase();
            let result = cells[6]?.innerText.toLowerCase();

            let matchesFilter = filterValue === "all" || result === filterValue;
            let matchesSearch =
              searchValue === "" || armyNo.includes(searchValue);

            if (matchesFilter && matchesSearch) {
              row.style.display = "";
            } else {
              row.style.display = "none";
            }
          });
        });
      }

      function clearFilters() {
        document.getElementById("resultFilter").value = "All";
        document.getElementById("armySearch").value = "";
        applyFilters();
      }

      // Populate datalist with Army Nos
      window.onload = function () {
        let datalist = document.getElementById("armyNoList");
        let armyNumbers = new Set();

        let tables = document.querySelectorAll(".summary-table");
        tables.forEach((table) => {
          let rows = table.querySelectorAll("tbody tr");
          rows.forEach((row) => {
            let armyNo = row.querySelectorAll("td")[1]?.innerText;
            if (armyNo) {
              armyNumbers.add(armyNo);
            }
          });
        });

        armyNumbers.forEach((no) => {
          let option = document.createElement("option");
          option.value = no;
          datalist.appendChild(option);
        });
      };
    </script>
    <script src="training-jco.js"></script>
  </body>
</html>
