<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Trg JCO / Admin Summary</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        background: linear-gradient(135deg, #a8e063, #f6d365);
      }

      /* Page Header */
      .page-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 15px 40px;
        background: linear-gradient(45deg, #a8e063, #f6d365);
        border-bottom: 3px solid #444;
        position: sticky;
        top: 0;
        z-index: 2000;
      }
      .page-header h1 {
        flex: 1;
        text-align: center;
        font-size: 28px;
        font-weight: bold;
        color: #222;
        text-transform: uppercase;
        letter-spacing: 2px;
      }
      .page-header .logo {
        width: 60px;
        height: 60px;
        object-fit: contain;
      }

      /* Filter Bar */
      .filter-bar {
        position: sticky;
        top: 80px; /* below header */
        z-index: 1000;
        display: flex;
        justify-content: flex-start;
        align-items: center;
        gap: 15px;
        padding: 12px 20px;
        background: linear-gradient(45deg, #a8e063, #f6d365);
        border-bottom: 2px solid #ccc;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }
      .filter-bar label {
        font-weight: bold;
      }
      .filter-bar select,
      .filter-bar input,
      .filter-bar button {
        padding: 6px 10px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 14px;
      }
      .filter-bar button {
        background: linear-gradient(45deg, #ff6b6b, #f06595);
        color: white;
        cursor: pointer;
        transition: 0.3s;
      }
      .filter-bar button:hover {
        background: linear-gradient(45deg, #fa5252, #d6336c);
      }

      /* Table Styling */
      .summary-section {
        margin: 25px;
        padding: 20px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
      }
      .summary-section h2 {
        text-align: center;
        margin-bottom: 15px;
        color: #333;
        font-size: 22px;
      }
      .summary-table {
        width: 100%;
        border-collapse: collapse;
      }
      .summary-table th,
      .summary-table td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: center;
        font-size: 14px;
      }
      .summary-table th {
        background: #f4f4f4;
        font-weight: bold;
        position: sticky;
        top: 120px; /* keeps table headers visible under filter bar */
        z-index: 500;
      }
      .summary-table tr:nth-child(even) {
        background: #f9f9f9;
      }
      .material-card {
        border: 1px solid #ccc;
        padding: 10px;
        margin: 10px;
        border-radius: 10px;
      }
    </style>
  </head>
  <body>
    <!-- Page Header -->
    <header class="page-header">
      <img src="/LOGO 1 LEFT.png" alt="Left Logo" class="logo" />
      <h1>Trg JCO / Admin</h1>
      <img src="/syn 5 logo.jpeg" alt="Right Logo" class="logo" />
    </header>

    <!-- Filter Bar -->
    <div class="filter-bar">
      <label>Filter by Result:</label>
      <select id="resultFilter" onchange="applyFilters()">
        <option value="All">All</option>
        <option value="Passed">Passed</option>
        <option value="Failed">Failed</option>
        <option value="Qualified">Qualified</option>
        <option value="Unqualified">Unqualified</option>
        <option value="Selected">Selected</option>
        <option value="Not Selected">Not Selected</option>
        <option value="MM">MM</option>
        <option value="FC">FC</option>
        <option value="SS">SS</option>
      </select>

      <label>Search by Army No:</label>
      <input
        list="armyNoList"
        id="armySearch"
        placeholder="Enter Army No..."
        onkeyup="applyFilters()"
      />
      <datalist id="armyNoList"></datalist>

      <button onclick="clearFilters()">Clear Filters</button>
    </div>

    <!-- Course Summary -->
    <div class="summary-section">
      <h2><b>Course Summary</b></h2>
      <form onsubmit="assignCourseToUser(event)">
        <label>Course</label>
        <select id="courseSelect">
          <option value="">Select Course</option>
        </select>
        <label>Students</label>
        <select id="studentSelect">
          <option value="">Select Student</option>
        </select>
        <button type="submit">Assign Course</button>
      </form>
      <table class="summary-table">
        <thead>
          <tr>
            <th>S No</th>
            <th>Army No</th>
            <th>Rank</th>
            <th>Name</th>
            <th>Course</th>
            <th>Event</th>
            <th>Results</th>
            <th>Remarks</th>
          </tr>
        </thead>
        <tbody id="bpetSummary"></tbody>
      </table>
    </div>

    <div class="summary-section add-student">
      <h2><b>Add Student</b></h2>
      <form onsubmit="addStudent(event)">
        <table>
          <tr>
            <td>Army No</td>
            <td>
              <input
                placeholder="Army No"
                type="text"
                name="army_no"
                id="armyNo"
              />
            </td>
          </tr>
          <tr>
            <td>Rank</td>
            <td>
              <select name="rank" id="rank">
                <option value="SEP">SEP</option>
                <option value="NK">NK</option>
                <option value="HAV">HAV</option>
              </select>
            </td>
          </tr>
          <tr>
            <td>Name</td>
            <td>
              <input placeholder="Name" type="text" name="name" id="name" />
            </td>
          </tr>
          <tr>
            <td></td>
          </tr>
          <tr>
            <td colspan="2" style="text-align: end">
              <button type="submit">Add Student</button>
            </td>
          </tr>
        </table>
      </form>
    </div>

    <div class="summary-section">
      <h2><b>Upload Report</b></h2>
      <form onsubmit="uploadReport(event)" enctype="multipart/form-data">
        <table>
          <tr>
            <td><label for="title">Title</label></td>
            <td>
              <input placeholder="Title" type="text" name="title" id="title" />
            </td>
          </tr>
          <tr>
            <td><label for="description">Description</label></td>
            <td>
              <input
                placeholder="Description"
                type="text"
                name="description"
                id="description"
              />
            </td>
          </tr>
          <tr>
            <td><label for="course">Course</label></td>
            <td>
              <select name="course" id="courseSelect-upload">
                <option value="">Select Course</option>
              </select>
            </td>
          </tr>
          <tr>
            <td><label for="forRole">For Role</label></td>
            <td>
              <select name="forRole" id="forRole">
                <option value="CO">CO</option>
                <option value="TrgOffr" selected>TrgOffr</option>
                <option value="Student">Student</option>
              </select>
            </td>
          </tr>
          <tr>
            <td><label for="type">Type</label></td>
            <td>
              <select name="type" id="type">
                <option value="report">Report</option>
                <option value="study">Study</option>
                <option value="planning">Planning</option>
              </select>
            </td>
          </tr>
          <tr>
            <td><label for="report">File</label></td>
            <td>
              <input type="file" accept=".pdf" name="file" id="file" />
            </td>
          </tr>
          <tr>
            <td colspan="2" style="text-align: end">
              <button type="submit">Upload</button>
            </td>
          </tr>
        </table>
      </form>
    </div>

    <div class="summary-section">
      <h2><b>Materials</b></h2>
      <div id="materialSelect"></div>
    </div>

    <!-- Filtering Script -->
    <script>
      function applyFilters() {
        let filterValue = document
          .getElementById("resultFilter")
          .value.toLowerCase();
        let searchValue = document
          .getElementById("armySearch")
          .value.toLowerCase();

        let tables = document.querySelectorAll(".summary-table");
        tables.forEach((table) => {
          let rows = table.querySelectorAll("tbody tr");
          rows.forEach((row) => {
            let cells = row.querySelectorAll("td");
            let armyNo = cells[1]?.innerText.toLowerCase();
            let result = cells[6]?.innerText.toLowerCase();

            let matchesFilter = filterValue === "all" || result === filterValue;
            let matchesSearch =
              searchValue === "" || armyNo.includes(searchValue);

            if (matchesFilter && matchesSearch) {
              row.style.display = "";
            } else {
              row.style.display = "none";
            }
          });
        });
      }

      function clearFilters() {
        document.getElementById("resultFilter").value = "All";
        document.getElementById("armySearch").value = "";
        applyFilters();
      }

      // Populate datalist with Army Nos
      window.onload = function () {
        let datalist = document.getElementById("armyNoList");
        let armyNumbers = new Set();

        let tables = document.querySelectorAll(".summary-table");
        tables.forEach((table) => {
          let rows = table.querySelectorAll("tbody tr");
          rows.forEach((row) => {
            let armyNo = row.querySelectorAll("td")[1]?.innerText;
            if (armyNo) {
              armyNumbers.add(armyNo);
            }
          });
        });

        armyNumbers.forEach((no) => {
          let option = document.createElement("option");
          option.value = no;
          datalist.appendChild(option);
        });
      };
    </script>
    <script src="training-jco.js"></script>
  </body>
</html>
